import psycopg2
import pandas as pd

# DB connection settings
DB_NAME = "your_db_name"
DB_USER = "your_username"
DB_PASS = "your_password"
DB_HOST = "localhost"
DB_PORT = "5432"

# Connect to PostgreSQL
conn = psycopg2.connect(
    dbname=DB_NAME, user=DB_USER, password=DB_PASS, host=DB_HOST, port=DB_PORT
)
cur = conn.cursor()

# Step 1: Create Table
cur.execute("""
CREATE TABLE IF NOT EXISTS water_quality (
    id SERIAL PRIMARY KEY,
    state VARCHAR(100),
    district VARCHAR(100),
    block VARCHAR(100),
    panchayat VARCHAR(100),
    village VARCHAR(100),
    source_type VARCHAR(100),
    parameter VARCHAR(100),
    value VARCHAR(50),
    result VARCHAR(50),
    test_date DATE
);
""")
conn.commit()

# Step 2: Load CSV
df = pd.read_csv("data/water_quality.csv")

# Rename columns if needed (match dataset headers with table schema)
df = df.rename(columns={
    "State": "state",
    "District": "district",
    "Block": "block",
    "Panchayat": "panchayat",
    "Village": "village",
    "SourceType": "source_type",
    "Parameter": "parameter",
    "Value": "value",
    "Result": "result",
    "TestDate": "test_date"
})

# Step 3: Insert Data into DB
for _, row in df.iterrows():
    cur.execute("""
        INSERT INTO water_quality (state, district, block, panchayat, village, source_type, parameter, value, result, test_date)
        VALUES (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)
    """, (
        row['state'], row['district'], row['block'], row['panchayat'],
        row['village'], row['source_type'], row['parameter'],
        row['value'], row['result'], row['test_date']
    ))

conn.commit()
print("âœ… Data inserted successfully!")

cur.close()
conn.close()
